<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>SecretSanta</title>
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/fonts.css">
    <style>
        td, th {
            padding: 0 1rem;
            line-height: normal;
        }
    </style>
</head>
<body>
<div class="container">

    <div class="row">
        <div class="col s12">
            <h2>Participants (<span data-bind="text: santas().length"></span>)</h2>
        </div>
    </div>

    <div class="row">
        <form class="col s12" data-bind="submit: addSanta">
            <div class="row">
                <div class="input-field col s6">
                    <input type="text" id="new_name" data-bind="value: newName">
                    <label for="new_name">Name</label>
                </div>
                <div class="input-field col s6">
                    <input type="email" id="new_mail" data-bind="value: newMail">
                    <label for="new_mail">E-Mail</label>
                </div>
            </div>
            <div class="row">
                <div class="col s12 right-align">
                    <button class="waves-effect waves-light btn-small green black-text" type="submit">
                        <i class="material-icons left">add</i>
                        Add a Santa
                    </button>
                    <button data-bind="click: sendMails, enable: santas().length > 2"
                            class="waves-effect waves-light btn-small blue black-text">
                        <i class="material-icons left">email</i>
                        Next step
                    </button>
                </div>
            </div>
        </form>
    </div>

    <div class="row" data-bind="visible: santas().length > 0">
        <div class="col s12">
            <table class="striped">
                <thead>
                <tr>
                    <th>Santa's name</th>
                    <th>Santa's e-mail address</th>
                    <th></th>
                </tr>
                </thead>
                <tbody data-bind="foreach: santas">
                <tr>
                    <td><p data-bind="text: name"></p></td>
                    <td><p data-bind="text: mail"></p></td>
                    <td><a href="#" data-bind="click: $root.removeSanta">Remove</a></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script type="text/javascript" src="js/materialize.min.js"></script>
<script type="text/javascript" src="js/knockout-3.4.2.min.js"></script>
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
// Class to represent a row in the seat reservations grid
        function Santa(name, mail) {
            let self = this;
            self.name = name;
            self.mail = mail;
        }

// Overall viewmodel for this screen, along with initial state
        function SantaViewModel() {
            let self = this;
            self.newName = ko.observable();
            self.newMail = ko.observable();
            self.santas = ko.observableArray([ // todo remove demo data
                new Santa("Foo", "foo@example.com"),
                new Santa("Bar", "bar@example.com"),
                new Santa("Baz", "baz@example.com"),
                new Santa("Foobar", "foobar@example.com"),
                new Santa("Foobaz", "foobaz@example.com")
            ]);

            self.addSanta = function () {
                let valid = true;
                let name = self.newName();
                let mail = self.newMail();
                if (!name) {
                    M.toast({html: '<i class="material-icons left">error</i>invalid name', classes: 'rounded red'});
                    valid = false;
                }
                if (!mail) {
                    M.toast({html: '<i class="material-icons left">error</i>invalid mail', classes: 'rounded red'});
                    valid = false;
                }
                if (!valid) {
                    return;
                }
                M.Toast.dismissAll();
                M.toast({html: '<i class="material-icons left">face</i>added ' + name, classes: 'rounded green'});
                self.newName("");
                self.newMail("");
                self.santas.push(new Santa(name, mail));
            };

            self.removeSanta = function (santa) {
                self.santas.remove(santa);
            };

            self.sendMails = function () {
                alert("Let's go!");
            };
        }

        ko.applyBindings(new SantaViewModel());

    });
</script>
</body>
</html>